import yara
from os import path

def scanFile(filePath):
        #
        #cuurrently just doing basic YARA scan, expected to implement usage of virustotal api for better detection ability
        #
        while (1):
            rulesPath = input("Please provide a path to the rules file you want to scan with: ")
            if (path.exists(rulesPath)) and path.isfile(rulesPath):
                rules = yara.compile(rulesPath)
                print("scanning...")
                result = rules.match(filePath)
                if result:
                    print("the scanned file met the requirements of the following rules: " + str(result) + "\nPlease check how trusted is this file")
                else:
                    print("No suspections where found during the scan")
                break
            else:
                print("Invalid file path.")
                continue
    

def getFile():#get file path and validate it
    while (1):
        filePath = input("Please provide a file path to the file you want to scan: ")
        #
        #you should try and implement folder scanning as well
        #
        if (path.exists(filePath)) and path.isfile(filePath):
            print("valid file, proceeding")
            return filePath
            break
        else:
            print("Invalid file path.")
            continue
    
def main():
    fileToScan = getFile()
    scanFile(fileToScan)

if __name__ == "__main__":
    main()
